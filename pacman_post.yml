---
- name: copy package-list script
  become_user: root
  copy:
    src: files/create-package-list
    dest: rootfs_files/create-package-list
    mode: 0755

- name: create package list
  delegate_to: chroot
  command: /create-package-list

- name: cleanup pacman cache
  become_user: root
  file:
    path: '{{ item }}'
    state: absent
  with_fileglob:
    - 'rootfs_files/var/cache/pacman/pkg/*'

- name: copy list of packages
  copy:
    src: rootfs_files/pkglist.txt
    dest: iso_files/arch/pkglist.x86_64.txt

- name: remove script
  become_user: root
  file:
    path: rootfs_files/create-package-list
    state: absent

- name: remove list of packages
  become_user: root
  file:
    path: rootfs_files/pkglist.txt
    state: absent
